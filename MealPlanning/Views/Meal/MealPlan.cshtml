@model DSchiefer_CPT206_MealPlanning.Models.WeeklyMealPlan

@{
    var userName = Model.MealInput?.Name ?? "Your";
    var userEmail = Model.MealInput?.Email ?? "";
}

<div class="text-center mb-4">
    <h2 class="display-5 fw-bold">@userName's 7-Day Meal Plan</h2>
    <p class="lead">Custom meal plan tailored just for you!</p>
</div>

@if (Model?.WeeklyPlan != null && Model.WeeklyPlan.Any())
{
    <div class="d-grid gap-4">

        @for (int i = 0; i < Model.WeeklyPlan.Count; i++)
        {
            var dayPlan = Model.WeeklyPlan[i];
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white fs-4">
                    Day @(i + 1)
                </div>
                <div class="card-body fs-5">
                    <p>
                        <strong>Breakfast:</strong>
                        @if (!string.IsNullOrEmpty(dayPlan.Breakfast?.Name) && !string.IsNullOrEmpty(dayPlan.Breakfast?.RecipeUrl))
                        {
                            <a href="@dayPlan.Breakfast.RecipeUrl" target="_blank" style="text-decoration: underline;">
                                @dayPlan.Breakfast.Name
                            </a>
                        }
                        else
                        {
                            <span>No breakfast listed</span>
                        }
                    </p>
                    <p>
                        <strong>Lunch:</strong>
                        @if (!string.IsNullOrEmpty(dayPlan.Lunch?.Name) && !string.IsNullOrEmpty(dayPlan.Lunch?.RecipeUrl))
                        {
                            <a href="@dayPlan.Lunch.RecipeUrl" target="_blank" style="text-decoration: underline;">
                                @dayPlan.Lunch.Name
                            </a>
                        }
                        else
                        {
                            <span>No lunch listed</span>
                        }
                    </p>
                    <p>
                        <strong>Dinner:</strong>
                        @if (!string.IsNullOrEmpty(dayPlan.Dinner?.Name) && !string.IsNullOrEmpty(dayPlan.Dinner?.RecipeUrl))
                        {
                            <a href="@dayPlan.Dinner.RecipeUrl" target="_blank" style="text-decoration: underline;">
                                @dayPlan.Dinner.Name
                            </a>
                        }
                        else
                        {
                            <span>No dinner listed</span>
                        }
                    </p>
                </div>
            </div>
        }

        <div class="d-flex justify-content-center gap-3 mt-4">
            <!-- Edit Plan Button -->
            <form asp-action="Index" asp-controller="Home" method="post" class="d-inline">
                <input type="hidden" name="Name" value="@Model.MealInput?.Name" />
                <input type="hidden" name="Email" value="@Model.MealInput?.Email" />
                <input type="hidden" name="Request" value="@Model.MealInput?.Request" />
                <input type="hidden" name="Likes" value="@Model.MealInput?.Likes" />
                <input type="hidden" name="Dislikes" value="@Model.MealInput?.Dislikes" />
                <input type="hidden" name="Allergies" value="@Model.MealInput?.Allergies" />

                <button type="submit" class="btn btn-lg btn-outline-primary">
                    Go Back & Edit Plan
                </button>
            </form>

            <!-- Send to Email Button -->
            <form asp-controller="SendMailer" asp-action="SendEmail" method="post" class="d-inline">
                <input type="hidden" name="From" value="mealplanningapp777@gmail.com" />
                <input type="hidden" name="To" value="@Model.MealInput?.Email" />
                <input type="hidden" name="Subject" value="Your Personalized Meal Plan" />

                @for (int i = 0; i < Model.WeeklyPlan.Count; i++)
                {
                    <input type="hidden" name="WeeklyPlan[@i].Breakfast.Name" value="@Model.WeeklyPlan[i].Breakfast?.Name" />
                    <input type="hidden" name="WeeklyPlan[@i].Breakfast.RecipeUrl" value="@Model.WeeklyPlan[i].Breakfast?.RecipeUrl" />
                    <input type="hidden" name="WeeklyPlan[@i].Lunch.Name" value="@Model.WeeklyPlan[i].Lunch?.Name" />
                    <input type="hidden" name="WeeklyPlan[@i].Lunch.RecipeUrl" value="@Model.WeeklyPlan[i].Lunch?.RecipeUrl" />
                    <input type="hidden" name="WeeklyPlan[@i].Dinner.Name" value="@Model.WeeklyPlan[i].Dinner?.Name" />
                    <input type="hidden" name="WeeklyPlan[@i].Dinner.RecipeUrl" value="@Model.WeeklyPlan[i].Dinner?.RecipeUrl" />
                }

                <button type="submit" class="btn btn-success btn-lg">
                    <i class="bi bi-envelope"></i> Send to Email
                </button>
            </form>
        </div>
    </div>
}
else
{
    <div class="alert alert-warning fs-5 text-center mt-4">
        No meal plan available.
    </div>
}